name: Obfuscate

# Help: https://help.github.com/en/actions/automating-your-workflow-with-github-actions/workflow-syntax-for-github-actions

on: [push, pull_request]

jobs:
  obfuscate:
    # Run pytest tests on pickle files (pre-generated SC2 API observations)
    name: Obfuscate
    runs-on: ${{ matrix.os }}
    timeout-minutes: 10
    strategy:
      fail-fast: false
      matrix:
        # Python 3.6 fails due to: https://www.python.org/dev/peps/pep-0563/
        # If all type annotations were removed, this library should run in py3.6 and perhaps even 3.5
        os: [windows-latest]
#        os: [macos-latest, windows-latest, ubuntu-latest]
        python-version: [3.7, 3.8]

    steps:
      - uses: actions/checkout@v1

      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v1
        with:
          python-version: ${{ matrix.python-version }}

      - name: Install dependencies
        run: |
          pip install burnysc2 pyinstaller
          mkdir tempFolder
          mkdir mybot_obfuscated

      # Create config
      - name: Run regex_output_config.py
        run: |
          python regex_output_config.py

      - name: Move bot to tempFolder
        run: |
          move mybot/* tempFolder/

      - name: Obfuscate
        run: |
          python opy.py tempFolder mybot_obfuscated tempFolder/opy_config.txt

      - name: Move sc2/ folder to obfuscated folder
        run: |
          move sc2 mybot_obfuscated/
          dir mybot_obfuscated
          ls mybot_obfuscated

      - name: Upload obfuscated files
        uses: actions/upload-artifact@v1
        with:
          name: Bot_obfuscated
          path: mybot_obfuscated_${{ matrix.os }}

